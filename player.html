<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Player Video</title>
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <style>
    html, body {
      margin: 0; padding: 0;
      background-color: #000;
      height: 100%; width: 100%;
      overflow: hidden;
    }
    #player {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      background: #000;
    }

    /* logo-ul (watermark) Clappr â€“ 25% opacitate, nu blocheazÄƒ clickurile */
    .watermark {
      opacity: 0.25 !important;
      pointer-events: none !important;
    }

    /* textul brand â€“ Ã®l ataÈ™Äƒm Ã®n DOM-ul Clappr ca sÄƒ fie inclus Ã®n fullscreen */
    .brand-text {
      position: absolute;
      right: 12px; bottom: 10px;
      color: #fff;
      opacity: 0.25;                   /* 25% vizibilitate */
      font-weight: 800;
      letter-spacing: 0.5px;
      line-height: 1;
      user-select: none;
      pointer-events: none;             /* nu Ã®ncurcÄƒ controalele */
      z-index: 2147483647;
      font-size: clamp(12px, 2.2vw, 26px);
      text-shadow: 0 1px 2px rgba(0,0,0,.7);
    }

    /* Buton fallback pentru cazul Ã®n care autoplay cu sunet e blocat de browser */
    #unmute-btn {
      position: absolute;
      top: 10px; left: 10px;
      padding: 10px 16px;
      background: rgba(0,0,0,.6);
      color: #fff;
      border: none; border-radius: 6px;
      cursor: pointer;
      z-index: 2147483647;
      font-size: 14px;
      display: none;
    }
    @media (max-width: 768px) {
      #unmute-btn { padding: 8px 12px; font-size: 13px; }
    }
  </style>
</head>
<body>
  <div id="player">
    <button id="unmute-btn" type="button">ðŸ”Š ActiveazÄƒ Sunetul</button>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const videoUrl  = urlParams.get('url');
    let player;
    let brandEl = null;

    function createBrandEl() {
      if (brandEl) return brandEl;
      brandEl = document.createElement('div');
      brandEl.className = 'brand-text';
      brandEl.textContent = 'WwW.Sporturi-Live.Ro';
      return brandEl;
    }

    function attachBrandTo(target) {
      if (!target) return;
      const el = createBrandEl();
      // ne asigurÄƒm cÄƒ e poziÈ›ionat relativ containerul-È›intÄƒ
      if (getComputedStyle(target).position === 'static') {
        target.style.position = 'relative';
      }
      // mutÄƒm (appendChild mutÄƒ, nu copiazÄƒ)
      target.appendChild(el);
    }

    function hostForOverlay() {
      // preferÄƒm containerul intern Clappr (cel care intrÄƒ Ã®n fullscreen)
      if (player && player.core && player.core.el) return player.core.el;
      if (player && player.el) return player.el;
      return document.querySelector('#player');
    }

    // Ã®n unele browsere elementul exact care intrÄƒ Ã®n fullscreen diferÄƒ; ne adaptÄƒm
    document.addEventListener('fullscreenchange', () => {
      const fs = document.fullscreenElement;
      if (fs) {
        // dacÄƒ fullscreenul e pe un nod din interiorul playerului, lipim textul acolo
        if (fs.contains(hostForOverlay())) {
          attachBrandTo(hostForOverlay());
        } else if (fs.classList && (fs.classList.contains('player') || fs.classList.contains('container'))) {
          attachBrandTo(fs);
        } else {
          // fallback: dacÄƒ Ã®n fullscreen e chiar wrapperul #player
          if (fs.id === 'player') attachBrandTo(fs);
        }
      } else {
        // ieÈ™ire din fullscreen â€“ Ã®l È›inem Ã®n hostul Clappr
        attachBrandTo(hostForOverlay());
      }
    });

    function showUnmute() {
      const b = document.getElementById('unmute-btn');
      if (b) b.style.display = 'inline-block';
    }
    function hideUnmute() {
      const b = document.getElementById('unmute-btn');
      if (b) b.style.display = 'none';
    }

    async function tryAutoplayWithSound() {
      const video = document.querySelector('#player video');
      if (!video) return;
      try {
        video.muted  = false;
        video.volume = 1.0;
        if (player) { player.setVolume(100); player.unmute && player.unmute(); }
        const p = video.play && video.play();
        if (p && typeof p.then === 'function') await p;
        hideUnmute();
      } catch(e) {
        showUnmute();
      }
    }

    function unmutePlayer() {
      const video = document.querySelector('#player video');
      if (video) { video.muted = false; video.volume = 1.0; video.play && video.play(); }
      if (player) { player.setVolume(100); player.unmute && player.unmute(); player.play && player.play(); }
      hideUnmute();
    }

    if (videoUrl) {
      player = new Clappr.Player({
        source: videoUrl,
        parentId: "#player",
        autoPlay: true,
        mute: false,                 // Ã®ncercÄƒm direct cu sunet
        width: "100%",
        height: "100%",
        // logo-ul tÄƒu, stÃ¢nga-sus, opacitate controlatÄƒ din CSS .watermark
        watermark: "https://raw.githubusercontent.com/bebe2007/bebe2007.github.io/refs/heads/main/logo.png",
        position: "top-left",
        watermarkLink: "https://sporturi-live.ro",
        playback: { playInline: true, preload: "auto" }
      });

      // cÃ¢nd playerul e gata: punem textul Ã®n DOM-ul Clappr
      player.on(Clappr.Events.PLAYER_READY, () => {
        attachBrandTo(hostForOverlay());
        tryAutoplayWithSound();
      });

      // dacÄƒ se porneÈ™te mut (politici browser), aratÄƒ butonul
      player.on(Clappr.Events.PLAYER_PLAY, () => {
        const video = document.querySelector('#player video');
        const actuallyMuted = (video && video.muted) || (player && player.isMuted && player.isMuted());
        if (actuallyMuted) showUnmute(); else hideUnmute();
      });

      document.getElementById('unmute-btn').addEventListener('click', unmutePlayer);
    } else {
      document.getElementById('player').innerHTML =
        '<p style="color:white;text-align:center;margin-top:20%;">Nu a fost furnizat niciun link video.</p>';
    }
  </script>
</body>
</html>
